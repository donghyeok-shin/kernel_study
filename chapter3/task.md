## 3. 태스크 관리

### 3.1 프로세스와 쓰레드, 태스크

- 태스크 : 자원소유권의 단위

- 쓰레드 : 수행의 단위

- 프로세스 : 동작중인 프로그램

- 프로그램 : 디스크에 저장된 실행 가능한 형태의 파일.

  

### 3.2 사용자 입장에서 프로세스 구조

사용자 프로세스가 수행되기 위해서는 커널로 부터 가상 주소 공간을 할당받아야 함. 32bit CPU의 경우 os는 각 프로세스에게 4GB(2^32) 크기의 가상 공간을 할당함.

프로세스는 크게 4가지 영역으로 구분되며, 각 영역을 세그먼트(segment) 또는 가상 메모리 객체(vm_area_struct)라고 부름.

- 텍스트(text) : 명령, 함수 등으로 구성되며, 프로세스 주소 공간의 가장 하위 영역. 실행되는 기계어 명령어, 어셈블리 코드가 저장되는 영역.

- 데이터(data) : data영역은 bss, data 영역으로 나눠지며, 전역 변수 등을 저장하는 공간. bss에는 초기화되지 않은 변수, data에는 초기화된 변수가 저장됨.

- 스택(stack) : 함수의 지역 변수를 담으며, 유저 영역과 커널 영역의 경계에 위치하며, 아래 방향으로 증가함.

- 힙(heap) : malloc/free 등 동적 할당의 영역이다. data의 위에 위치하며 heap은 위로 증가한다.

  ![image-20210712000951215](https://raw.githubusercontent.com/donghyeok-shin/image_server/main/img/image-20210712000951215.png)



### 3.3 프로세스와 쓰레드의 생성과 수행

fork()를 이용해 자식 프로세스를 생성할 수 있으며, fork() 함수는 부모에게는 자식 pid, 자식에게는 0, 실패하면 -1을 return함. 프로세스가 생성될 때 주소공간을 포함하여 프로세스를 위한 ==모든 자원들이 새로 할당==됨.

clone()를 이용해 쓰레드를 생성할 수 있으며, 프로세스 생성과 달리 쓰레드는 자식과 부모 쓰레드가 같은 주소공간을 공유함(위와 달리 새로 할당하지 않음).

execl()은 기존 프로세스의 주소 공간을 모두 없애며, 요청된 바이너리로 새로운 주소 공간을 생성함. fork와 vfork의 차이는 fork는 부모 프로세스의 주소공간을 복사하지만, vfork는 생성하지 않고 우선 같은 주소를 가리키며 execl을 사용해야 새롭게 공간을 할당받음.

vfork가 생긴 이유는 어차피 execl을 사용할 것이라면, excel은 요청된 바이너리의 주소공가능을 새롭게 생성하기 때문에 fork처럼 부모 프로세스의 주소공간을 복사하는 것이 무의미함. 이러한 불필요한 작업을 줄이기 위해 vfork가 사용됨.
